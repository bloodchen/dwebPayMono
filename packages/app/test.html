<!DOCTYPE html>
<html>

<head>
    <title>dappPay Demo</title>
    <meta charset="UTF-8">
    <script src="wapp.min.js"></script>

</head>

<body>
    <h2>Demo dappPay</h2>
    <br><br>
    <button onclick="onConnectWallet()"> Connect Wallet</button>
    <button onclick="onBalance()"> getBalance</button>
    <button onclick="onTransaction()"> sendTransaction</button>
    <div id="pay" style="width:300px;height:250px">
    </div>
    <script type="text/javascript">
        const wpay = new WalletApp();
        wpay.init({ appid: "app1.nbdomain.a", bridge: "http://192.168.1.102:9001", debug: false })
        console.log(wpay)
        let walletID = null
        wpay.on('session_notify', async (wallet_id, event) => {
            const name = event.name
            if (name === 'approved') {
                console.log("permission approved")
                walletID = wallet_id
                const ret = await wpay.getBalance(wallet_id, 'dfasfasdf', 'ar')
                console.log("getBalance:", ret)
            }
        })
        wpay.on('session_request', async (wallet_id, request) => {

        })
        wpay.onElse(async (eName, ...argc) => {
            console.log("got event from wapp", eName, ...argc)
            if (eName === "closed") {
                // wpay.disconnect()
            }
        })
        async function onConnectWallet() {
            //wpay.test()
            console.log(await wpay.connect(walletID, { permissions: "chains:['bsv','ar']" }))
        }
        async function onBalance() {
            const ret = await wpay.getBalance(walletID, 'dfasfasdf', 'ar')
            console.log("getBalance:", ret)
        }
        async function onTransaction() {
            const ret = await wpay.sendTransaction(walletID, { data: 'abc', to: { address: "dffasf", value: 1000 } }, 'ar')
            console.log("sendTransaction:", ret)
        }

    </script>
</body>

</html>