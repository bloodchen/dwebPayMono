<html>

<head>
    <title>WalletHost Demo</title>
    <meta charset="UTF-8">
    <script src="wallet.min.js"></script>

</head>

<body>
    <h2>Demo WalletPay</h2>
    <br><br>
    <button onclick="onConnectApp()"> Connect App</button>
    <button onclick="onNotify()"> Notify App</button>
    <input type="text" name="" id="peerid" />
    </div>
    <script type="text/javascript">
        async function getBalance() {
            return { code: 0, balance: 11111 }
        }
        const whost = new WalletHost();
        whost.init({})
        whost.on('session_request', async (from_id, request, ret) => {
            const { name, para } = request
            console.log("got request name:", name, " para:", para)
            if (name === 'getBalance') {
                const account = para[0], chain = para[1]
                const balance = await getBalance()
                //ret(balance)
                return balance
            }
            if (name === 'pair_request') { //return code:0 to approve
                const appInfo = para[0]
                return { code: 0 }
            }
            if (name === 'sendTransaction') {
                const body = para[0]
                return { code: 0 }
            }
        })
        whost.on('session_notify', async (from_id, event) => {
            const name = event.name

        })
        whost.onElse(async (eName, ...args) => {
            console.log("got event from whost", eName, args)
            if (eName === "closed") {
                // wpay.disconnect()
            }
        })
        async function onNotify() {
            whost.notify('switch_account', { chain: 'ar', account: 'jklljufacs' })
        }
        async function onConnectApp() {
            const peerid = document.querySelector('#peerid').value;
            whost.pair(peerid)
        }

    </script>
</body>

</html>